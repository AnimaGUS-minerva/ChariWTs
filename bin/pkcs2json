#!/bin/sh

in=$1
out=$2
certfile=$3
der=$(echo $in | sed -e's/.pkcs$/.der/')

certfilearg=
if [ -n "$certfile" ];
then
    certfilearg="-CAfile $certfile"
fi
#extra='-nosigs -noverify'
extra='-noverify'

base64 -d <$in >$der
(openssl cms -verify $certfilearg -inform der -in $der $extra \
        | sed -e's/,/,\n/g'; echo) >$out

